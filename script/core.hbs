<script>
  const sdkVersion = '{{global_config.sdkVersion}}';
  if (!sdkVersion) {
    console.error('ERROR: no sdkVersion specified, please specify an sdkVersion in the global_config.');
  }
</script>
<link rel="stylesheet" type="text/css" href="https://assets.sitescdn.net/answers/v{{global_config.sdkVersion}}/answers.css">
<link rel="stylesheet" type="text/css" href="bundle.css">
<script src="https://assets.sitescdn.net/answers/v{{global_config.sdkVersion}}/answerstemplates.compiled.min.js"></script>
<script>
  {{#babel}}
  function initAnswers() {
    const JAMBO_INJECTED_DATA = {{{json env.JAMBO_INJECTED_DATA}}} || {};
    const pages = JAMBO_INJECTED_DATA.pages || {};
    const IS_STAGING = HitchhikerJS.isStaging(pages.stagingDomains || []);
    ANSWERS.init(Object.assign(
      {"templateBundle": TemplateBundle.default},
      {
        experienceVersion: IS_STAGING ? 'STAGING' : 'PRODUCTION',
      },
      {{#with env.JAMBO_INJECTED_DATA}}
        {
          {{#if businessId}}businessId: "{{businessId}}",{{/if}}
          {{#with (lookup (lookup (lookup this 'answers') 'experiences') ../global_config.experienceKey)}}
            {{#if apiKey}}apiKey: "{{apiKey}}",{{/if}}
          {{/with}}
          onStateChange: (params) => {
            if ('parentIFrame' in window) {
              parentIFrame.sendMessage(iframeGetSearchParams());
            }
          },
        },
      {{/with}}
      {{{ json global_config }}},
      {
        {{#with (lookup verticalsToConfig verticalKey)}}
          {{#if verticalLimit}}
            search: {
              limit: {{verticalLimit}},
            },
          {{/if}}
        {{/with}}
      },
      {{{ json pageSettings }}},
      {
        onReady: () => {
          {{> @partial-block }}

          {{#if global_config.conversionTrackingEnabled}}
            ANSWERS.setConversionsOptIn(true);
          {{/if}}

          ANSWERS.registerHelper('all', function (...args) {
            return args.filter(item => item).length === args.length;
          });

          ANSWERS.registerHelper('any', function (...args) {
            return args.filter(item => item).length > 1;
          });
        }
      }
    ));
  };
{{/babel}}
</script>
<script src="https://assets.sitescdn.net/answers/v{{global_config.sdkVersion}}/answers.min.js" onload="initAnswers()" async></script>

